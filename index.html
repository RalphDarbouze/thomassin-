<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
    <title>RUBIS TV 2026 - Modern Adaptive Player</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ====== CORE RESET & VARIABLES ====== */
        :root {
            --primary: #4CAF50;
            --primary-dark: #388E3C;
            --accent: #2196F3;
            --danger: #F44336;
            --warning: #FF9800;
            --dark-bg: #0a0a0a;
            --card-bg: rgba(30, 30, 30, 0.95);
            --surface: rgba(40, 40, 40, 0.8);
            --text-primary: #FFFFFF;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-tertiary: rgba(255, 255, 255, 0.5);
            --border: rgba(255, 255, 255, 0.1);
            --gradient-primary: linear-gradient(135deg, var(--primary), var(--accent));
            --gradient-dark: linear-gradient(180deg, #121212 0%, var(--dark-bg) 100%);
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.5);
            --radius-sm: 6px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 28px;
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            background: var(--dark-bg);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', system-ui, sans-serif;
            font-size: 16px;
            line-height: 1.5;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ====== RESPONSIVE FONT SIZES ====== */
        @media (max-width: 768px) {
            html { font-size: 14px; }
        }

        @media (max-width: 480px) {
            html { font-size: 13px; }
        }

        @media (max-width: 320px) {
            html { font-size: 12px; }
        }

        /* ====== SMART WATCH STYLES ====== */
        @media (max-width: 240px), (max-height: 240px) {
            html { font-size: 10px; }
            
            .watch-hide {
                display: none !important;
            }
            
            .watch-show {
                display: block !important;
            }
            
            .watch-compact {
                padding: 4px !important;
                margin: 2px !important;
            }
            
            .watch-text-sm {
                font-size: 8px !important;
            }
        }

        /* ====== APP CONTAINER ====== */
        .app-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100vh;
            height: 100dvh;
            background: var(--gradient-dark);
            position: relative;
            overflow: hidden;
        }

        /* ====== MODERN TOP BAR ====== */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            height: 60px;
            min-height: 60px;
            z-index: 1000;
            position: relative;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-shrink: 0;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .logo-text {
            font-size: 1.125rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .logo-year {
            color: var(--warning);
            font-weight: 600;
        }

        /* ====== CHANNEL INPUT ====== */
        .channel-input-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: auto;
            margin-right: 1rem;
        }

        .channel-input {
            width: 80px;
            padding: 0.5rem 0.75rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            outline: none;
            transition: all var(--transition-fast);
        }

        .channel-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
            transform: scale(1.05);
        }

        .channel-input-btn {
            padding: 0.5rem 1rem;
            background: var(--gradient-primary);
            border: none;
            border-radius: var(--radius-md);
            color: white;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .channel-input-btn:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-sm);
        }

        /* ====== COMPACT TOP CONTROLS ====== */
        .top-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .network-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.75rem;
            background: var(--surface);
            border-radius: var(--radius-xl);
            border: 1px solid var(--border);
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .network-speed {
            color: var(--primary);
            font-weight: 600;
            font-family: 'Monaco', 'Consolas', monospace;
        }

        .time-display {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
            padding: 0.5rem;
            min-width: 60px;
            text-align: center;
        }

        /* ====== MAIN CONTENT AREA ====== */
        .main-content {
            display: flex;
            flex: 1;
            position: relative;
            overflow: hidden;
            height: calc(100vh - 60px);
        }

        /* ====== ADAPTIVE SIDEBAR ====== */
        .channel-sidebar {
            width: 280px;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            z-index: 100;
            transition: transform var(--transition-normal);
            will-change: transform;
        }

        .channel-sidebar.collapsed {
            transform: translateX(-280px);
        }

        .sidebar-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-header h2 {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-container {
            position: relative;
            margin-bottom: 0.75rem;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 0.75rem 0.75rem 2.5rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            font-size: 0.875rem;
            outline: none;
            transition: all var(--transition-fast);
        }

        .search-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
            font-size: 0.875rem;
        }

        /* ====== CHANNEL LIST ====== */
        .channel-list {
            flex: 1;
            overflow-y: auto;
            padding: 0.75rem;
            scroll-behavior: smooth;
        }

        .channel-category {
            margin-bottom: 1.25rem;
        }

        .category-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
            padding-left: 0.5rem;
        }

        .channel-card {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.375rem;
            background: var(--surface);
            border-radius: var(--radius-md);
            border-left: 3px solid transparent;
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
            overflow: hidden;
        }

        .channel-card:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(4px);
        }

        .channel-card.active {
            background: rgba(76, 175, 80, 0.1);
            border-left-color: var(--primary);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
        }

        .channel-badge {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
            color: white;
            margin-right: 0.75rem;
            flex-shrink: 0;
        }

        .channel-badge.three-digit {
            width: 42px;
            font-size: 0.7rem;
        }

        .channel-info {
            flex: 1;
            min-width: 0;
        }

        .channel-name {
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.125rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .channel-meta {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .live-indicator {
            width: 6px;
            height: 6px;
            background: var(--danger);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* ====== MODERN PLAYER AREA ====== */
        .player-container {
            flex: 1;
            position: relative;
            background: #000;
            overflow: hidden;
        }

        #video-player {
            width: 100%;
            height: 100%;
            object-fit: contain;
            outline: none;
            background: #000;
        }

        .player-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(20, 20, 20, 0.9), rgba(10, 10, 10, 0.95));
            color: var(--text-secondary);
            text-align: center;
            padding: 2rem;
            z-index: 5;
        }

        .placeholder-icon {
            font-size: 4rem;
            color: var(--text-tertiary);
            margin-bottom: 1.5rem;
            opacity: 0.3;
        }

        .placeholder-text {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .placeholder-subtext {
            font-size: 1rem;
            color: var(--text-secondary);
            max-width: 400px;
            line-height: 1.6;
        }

        /* ====== FLOATING CONTROLS ====== */
        .floating-controls {
            position: absolute;
            bottom: 1.5rem;
            right: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            z-index: 50;
        }

        .control-button {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem;
            transition: all var(--transition-fast);
            box-shadow: var(--shadow-md);
        }

        .control-button:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
            border-color: var(--primary);
        }

        .control-button.primary {
            background: var(--gradient-primary);
            border: none;
        }

        /* ====== VIEWER COUNTER ====== */
        .viewer-counter {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: var(--radius-xl);
            padding: 0.625rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: white;
            font-size: 0.875rem;
            font-weight: 500;
            z-index: 50;
            box-shadow: var(--shadow-sm);
        }

        .viewer-count {
            color: var(--primary);
            font-weight: 700;
            font-size: 1rem;
            min-width: 40px;
            text-align: center;
        }

        .connection-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 0.25rem;
        }

        .dot-connected {
            background: var(--primary);
            box-shadow: 0 0 8px var(--primary);
        }

        .dot-connecting {
            background: var(--warning);
            animation: pulse 1.5s infinite;
        }

        .dot-disconnected {
            background: var(--danger);
        }

        /* ====== BUFFERING OVERLAY ====== */
        .buffering-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-normal);
        }

        .buffering-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .loader {
            width: 64px;
            height: 64px;
            border: 3px solid transparent;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1.5rem;
        }

        .loader-inner {
            width: 48px;
            height: 48px;
            border: 2px solid transparent;
            border-bottom: 2px solid var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite reverse;
        }

        /* ====== CHANNEL DISPLAY OVERLAY ====== */
        .channel-display-overlay {
            position: absolute;
            top: 1.5rem;
            left: 1.5rem;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 1rem 1.5rem;
            z-index: 50;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            transition: opacity var(--transition-normal);
            max-width: min(400px, 90%);
        }

        .channel-display-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .channel-display-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            line-height: 1;
        }

        .channel-display-name {
            font-size: 1.125rem;
            font-weight: 600;
            color: white;
        }

        .channel-display-group {
            font-size: 0.875rem;
            color: var(--text-tertiary);
        }

        /* ====== PLAYER OVERLAY CONTROLS ====== */
        .player-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 30%);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            opacity: 0;
            transition: opacity var(--transition-normal);
            pointer-events: none;
            z-index: 40;
        }

        .player-overlay.hidden {
            opacity: 0 !important;
            pointer-events: none !important;
        }

        .player-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .controls-bar {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 1rem;
            margin: 1rem;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            transition: opacity var(--transition-normal);
        }

        .controls-bar.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .playback-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            transition: all var(--transition-fast);
        }

        .control-icon:hover {
            background: rgba(76, 175, 80, 0.3);
            transform: scale(1.05);
        }

        .control-icon.play {
            width: 48px;
            height: 48px;
            background: var(--gradient-primary);
            font-size: 1.25rem;
        }

        .control-icon:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .control-icon:disabled:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: none;
        }

        .volume-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            min-width: 120px;
        }

        .volume-slider {
            flex: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* ====== PROGRESS BAR ====== */
        .progress-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            z-index: 45;
        }

        .progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            width: 0%;
            transition: width 0.1s;
            border-radius: 0 2px 2px 0;
        }

        /* ====== LOADING SCREEN ====== */
        .loading-screen {
            position: fixed;
            inset: 0;
            background: var(--dark-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .loading-logo {
            font-size: 2.5rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 2rem;
            text-align: center;
        }

        /* ====== ANIMATIONS ====== */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* ====== CUSTOM SCROLLBAR ====== */
        .channel-list::-webkit-scrollbar {
            width: 6px;
        }

        .channel-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 3px;
        }

        .channel-list::-webkit-scrollbar-thumb {
            background: rgba(76, 175, 80, 0.3);
            border-radius: 3px;
        }

        .channel-list::-webkit-scrollbar-thumb:hover {
            background: rgba(76, 175, 80, 0.5);
        }

        /* ====== FULLSCREEN MODE ====== */
        body.fullscreen {
            overflow: hidden !important;
            padding: 0 !important;
            margin: 0 !important;
        }

        body.fullscreen .app-container {
            background: #000 !important;
            width: 100vw !important;
            height: 100vh !important;
            max-width: 100vw !important;
            max-height: 100vh !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
        }

        body.fullscreen .top-bar,
        body.fullscreen .channel-sidebar {
            display: none !important;
        }

        body.fullscreen .player-container {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9999 !important;
        }

        body.fullscreen #video-player {
            object-fit: contain !important;
            width: 100% !important;
            height: 100% !important;
            display: block !important;
            background: #000 !important;
        }

        body.fullscreen .floating-controls {
            bottom: 2rem !important;
            right: 2rem !important;
        }

        body.fullscreen .viewer-counter {
            top: 2rem !important;
            right: 2rem !important;
        }

        body.fullscreen .channel-display-overlay {
            top: 2rem !important;
            left: 2rem !important;
        }

        /* ====== RESPONSIVE ADJUSTMENTS ====== */
        @media (max-width: 1024px) {
            .channel-sidebar {
                width: 240px;
            }
            
            .controls-bar {
                padding: 0.75rem;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .channel-sidebar {
                width: 100%;
                height: 40vh;
                border-right: none;
                border-bottom: 1px solid var(--border);
                position: absolute;
                bottom: 0;
                left: 0;
                transform: translateY(100%);
                z-index: 300;
            }
            
            .channel-sidebar.active {
                transform: translateY(0);
            }
            
            .floating-controls {
                bottom: 1rem;
                right: 1rem;
            }
            
            .control-button {
                width: 42px;
                height: 42px;
                font-size: 1rem;
            }
            
            .viewer-counter {
                top: 1rem;
                right: 1rem;
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
            }
            
            .channel-display-overlay {
                top: 1rem;
                left: 1rem;
                padding: 0.75rem 1rem;
            }
        }

        @media (max-width: 480px) {
            .top-controls {
                display: none;
            }
            
            .logo-container {
                flex: 1;
                justify-content: center;
            }
            
            .channel-input-container {
                margin-left: auto;
                margin-right: 0.5rem;
            }
            
            .channel-input {
                width: 60px;
                padding: 0.375rem 0.5rem;
                font-size: 0.875rem;
            }
            
            .channel-input-btn {
                padding: 0.375rem 0.75rem;
                font-size: 0.75rem;
            }
            
            .floating-controls {
                bottom: 0.75rem;
                right: 0.75rem;
                gap: 0.5rem;
            }
            
            .control-button {
                width: 36px;
                height: 36px;
                font-size: 0.875rem;
            }
            
            .channel-display-overlay {
                top: 0.75rem;
                left: 0.75rem;
                padding: 0.625rem 0.875rem;
            }
            
            .channel-display-number {
                font-size: 1.5rem;
            }
            
            .channel-display-name {
                font-size: 1rem;
            }
            
            .controls-bar {
                padding: 0.625rem;
                margin: 0.75rem;
                gap: 0.5rem;
            }
            
            .control-icon {
                width: 36px;
                height: 36px;
                font-size: 0.875rem;
            }
            
            .control-icon.play {
                width: 42px;
                height: 42px;
                font-size: 1rem;
            }
        }

        @media (max-width: 320px) {
            .logo-icon {
                width: 32px;
                height: 32px;
                font-size: 0.875rem;
            }
            
            .logo-text {
                font-size: 1rem;
            }
            
            .channel-input {
                width: 50px;
                padding: 0.25rem 0.375rem;
                font-size: 0.75rem;
            }
            
            .channel-input-btn {
                padding: 0.25rem 0.5rem;
                font-size: 0.625rem;
            }
            
            .floating-controls {
                bottom: 0.5rem;
                right: 0.5rem;
            }
            
            .viewer-counter {
                top: 0.5rem;
                right: 0.5rem;
                padding: 0.375rem 0.625rem;
            }
            
            .channel-display-overlay {
                top: 0.5rem;
                left: 0.5rem;
                padding: 0.5rem 0.75rem;
            }
            
            .channel-display-number {
                font-size: 1.25rem;
            }
            
            .channel-display-name {
                font-size: 0.875rem;
            }
        }

        /* ====== SMART WATCH OPTIMIZATIONS ====== */
        @media (max-width: 240px), (max-height: 240px), (pointer: coarse) and (max-width: 360px) {
            .app-container {
                height: 100dvh;
            }
            
            .top-bar {
                height: 40px;
                min-height: 40px;
                padding: 0.5rem;
            }
            
            .logo-icon {
                width: 24px;
                height: 24px;
                font-size: 0.75rem;
            }
            
            .logo-text {
                font-size: 0.75rem;
            }
            
            .time-display {
                font-size: 0.75rem;
                padding: 0.25rem;
                min-width: 40px;
            }
            
            .channel-input {
                width: 40px;
                padding: 0.25rem;
                font-size: 0.75rem;
            }
            
            .channel-input-btn {
                padding: 0.25rem 0.5rem;
                font-size: 0.625rem;
            }
            
            .floating-controls {
                bottom: 0.5rem;
                right: 0.5rem;
                gap: 0.25rem;
            }
            
            .control-button {
                width: 28px;
                height: 28px;
                font-size: 0.75rem;
            }
            
            .viewer-counter {
                top: 0.5rem;
                right: 0.5rem;
                padding: 0.25rem 0.5rem;
                font-size: 0.625rem;
                border-radius: 12px;
            }
            
            .viewer-count {
                font-size: 0.75rem;
                min-width: 24px;
            }
            
            .channel-display-overlay {
                top: 0.5rem;
                left: 0.5rem;
                padding: 0.5rem;
            }
            
            .channel-display-number {
                font-size: 1rem;
            }
            
            .channel-display-name {
                font-size: 0.75rem;
            }
            
            .controls-bar {
                padding: 0.5rem;
                margin: 0.5rem;
                border-radius: 8px;
            }
            
            .control-icon {
                width: 24px;
                height: 24px;
                font-size: 0.75rem;
            }
            
            .control-icon.play {
                width: 28px;
                height: 28px;
                font-size: 0.875rem;
            }
            
            .volume-container {
                min-width: 80px;
            }
            
            .progress-container {
                height: 2px;
            }
            
            /* Hide complex elements on watches */
            .channel-sidebar .search-container,
            .channel-sidebar .category-title,
            .channel-meta {
                display: none;
            }
            
            .channel-card {
                padding: 0.5rem;
                margin-bottom: 0.25rem;
            }
            
            .channel-badge {
                width: 24px;
                height: 24px;
                font-size: 0.625rem;
                margin-right: 0.5rem;
            }
            
            .channel-badge.three-digit {
                width: 28px;
                font-size: 0.5rem;
            }
            
            .channel-name {
                font-size: 0.75rem;
            }
        }

        /* ====== ACCESSIBILITY ====== */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        :focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        /* ====== UTILITY CLASSES ====== */
        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        .fade-out {
            animation: fadeOut 0.3s ease;
        }

        .slide-up {
            animation: slideIn 0.3s ease;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">RUBIS TV 2026</div>
        <div class="loader">
            <div class="loader-inner"></div>
        </div>
        <div style="text-align: center; margin-top: 1rem;">
            <p style="color: var(--text-tertiary); font-size: 0.875rem;">Modern Adaptive Player</p>
            <p style="color: var(--text-tertiary); font-size: 0.75rem; margin-top: 0.5rem;">Use channel input or click to select</p>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container" id="appContainer">
        <!-- Top Bar -->
        <header class="top-bar">
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-satellite-dish"></i>
                </div>
                <div class="logo-text">RUBIS <span class="logo-year">2026</span></div>
            </div>

            <!-- Channel Number Input -->
            <div class="channel-input-container">
                <input type="text" class="channel-input" id="channelInput" 
                       placeholder="000" maxlength="3" pattern="\d{1,3}" 
                       title="Enter 1-3 digit channel number">
                <button class="channel-input-btn" id="channelGoBtn">
                    <i class="fas fa-tv"></i> GO
                </button>
            </div>

            <div class="top-controls">
                <div class="network-indicator" id="networkStatus">
                    <i class="fas fa-wifi"></i>
                    <span>Speed:</span>
                    <span class="network-speed" id="networkSpeed">--</span>
                </div>
                
                <div class="time-display" id="currentTime">--:--</div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Channel Sidebar -->
            <aside class="channel-sidebar" id="channelSidebar">
                <div class="sidebar-header">
                    <h2><i class="fas fa-list"></i> Channels</h2>
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" id="channelSearch" 
                               placeholder="Search channels..." autocomplete="off">
                    </div>
                    <div style="font-size: 0.75rem; color: var(--text-tertiary);">
                        <span id="channelCount">0</span> channels available
                    </div>
                </div>

                <div class="channel-list" id="channelList">
                    <!-- Channels will be loaded here -->
                </div>
            </aside>

            <!-- Player Area -->
            <div class="player-container">
                <!-- Video Player -->
                <video id="video-player" playsinline preload="none" crossorigin="anonymous"></video>
                
                <!-- Player Placeholder (shown when no channel is selected) -->
                <div class="player-placeholder" id="playerPlaceholder">
                    <div class="placeholder-icon">
                        <i class="fas fa-tv"></i>
                    </div>
                    <div class="placeholder-text">Select a Channel</div>
                    <div class="placeholder-subtext">
                        Enter channel number above or click a channel from the list.
                        Channel display auto-hides after 5 seconds.
                    </div>
                </div>

                <!-- Channel Display Overlay -->
                <div class="channel-display-overlay hidden" id="channelDisplay">
                    <div class="channel-display-number" id="displayChannelNumber">000</div>
                    <div class="channel-display-name" id="displayChannelName">No Channel</div>
                    <div class="channel-display-group" id="displayChannelGroup">--</div>
                </div>

                <!-- Progress Bar -->
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>

                <!-- Floating Controls -->
                <div class="floating-controls">
                    <button class="control-button primary" id="fullscreenBtn" title="Fullscreen (F)">
                        <i class="fas fa-expand"></i>
                    </button>
                    <button class="control-button" id="sidebarToggle" title="Toggle Sidebar (S)">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>

                <!-- Viewer Counter -->
                <div class="viewer-counter" id="viewerCounter">
                    <i class="fas fa-users"></i>
                    <span class="viewer-count" id="viewerCount">0</span>
                    <div class="connection-dot dot-connecting" id="connectionDot"></div>
                </div>

                <!-- Buffering Overlay -->
                <div class="buffering-overlay" id="bufferingOverlay">
                    <div class="loader">
                        <div class="loader-inner"></div>
                    </div>
                    <div style="text-align: center;">
                        <h3 style="margin-bottom: 0.5rem; color: var(--primary);" id="bufferingText">
                            Loading Channel
                        </h3>
                        <p style="color: var(--text-tertiary); font-size: 0.875rem;" id="bufferingSubtext">
                            Preparing stream...
                        </p>
                    </div>
                </div>

                <!-- Player Overlay -->
                <div class="player-overlay hidden" id="playerOverlay">
                    <!-- Playback Controls -->
                    <div class="controls-bar hidden" id="controlsBar">
                        <div class="playback-controls">
                            <button class="control-icon" id="prevChannel" title="Previous Channel (â†‘)" disabled>
                                <i class="fas fa-step-backward"></i>
                            </button>
                            <button class="control-icon play" id="playPause" title="Play/Pause (Space)" disabled>
                                <i class="fas fa-play" id="playIcon"></i>
                            </button>
                            <button class="control-icon" id="nextChannel" title="Next Channel (â†“)" disabled>
                                <i class="fas fa-step-forward"></i>
                            </button>
                        </div>

                        <div class="volume-container">
                            <i class="fas fa-volume-up" id="volumeIcon"></i>
                            <input type="range" class="volume-slider" id="volumeSlider" 
                                   min="0" max="1" step="0.1" value="0.75" title="Volume" disabled>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ==================== MODERN UI STATE MANAGER ====================
        const UIState = {
            isPlaying: false,
            isFullscreen: false,
            isBuffering: false,
            isSidebarOpen: true,
            currentChannel: null,
            channels: [],
            filteredChannels: [],
            volume: 0.75,
            viewerCount: 0,
            wsConnected: false,
            overlayTimeout: null,
            hideOverlayTimeout: null,
            hasUserSelectedChannel: false,
            
            init() {
                console.log('ðŸŽ¬ Modern UI State Manager Initialized');
                this.updateClock();
                setInterval(() => this.updateClock(), 60000);
                
                // Load playlist
                this.loadPlaylist();
                
                // Initialize WebSocket for viewer counter
                this.initWebSocket();
                
                // Setup event listeners
                this.setupEventListeners();
                
                // Setup video player
                this.setupVideoPlayer();
                
                // Hide loading screen
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                }, 1500);
                
                // Adaptive sidebar for mobile
                if (window.innerWidth <= 768) {
                    this.isSidebarOpen = false;
                    document.getElementById('channelSidebar').classList.add('collapsed');
                }
                
                // Show placeholder (no auto-play)
                this.showPlayerPlaceholder(true);
            },
            
            updateClock() {
                const now = new Date();
                const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                document.getElementById('currentTime').textContent = timeString;
            },
            
            async loadPlaylist() {
                try {
                    // Using your playlist URL
                    const response = await fetch('https://gist.githubusercontent.com/RalphDarbouze/7fc242ebfecbba4f6854becb8b8abc94/raw/a5baba72203752afd0a0207654c00b5170b31ad6/my_first_iptv.m3u');
                    const text = await response.text();
                    this.parsePlaylist(text);
                } catch (error) {
                    console.error('Error loading playlist:', error);
                    this.loadDemoChannels();
                }
            },
            
            parsePlaylist(text) {
                const lines = text.split('\n');
                const channels = [];
                let currentChannel = null;
                let channelNumber = 1;

                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    if (line.startsWith('#EXTINF:')) {
                        const match = line.match(/#EXTINF:(-?\d+)\s*(.*?),(.*)/);
                        if (match) {
                            const [_, duration, attributes, name] = match;
                            const groupMatch = attributes.match(/group-title="([^"]+)"/);
                            
                            currentChannel = {
                                id: `channel-${channelNumber}`,
                                name: name.trim(),
                                group: groupMatch ? groupMatch[1] : 'General',
                                number: channelNumber,
                                url: null
                            };
                        }
                    } 
                    else if (line && !line.startsWith('#') && currentChannel) {
                        currentChannel.url = line;
                        channels.push(currentChannel);
                        channelNumber++;
                        currentChannel = null;
                    }
                }

                if (channels.length > 0) {
                    this.channels = channels;
                    this.filteredChannels = [...channels];
                    this.renderChannelList();
                } else {
                    this.loadDemoChannels();
                }
            },
            
            loadDemoChannels() {
                // Added 3-digit channel examples
                this.channels = [
                    { id: 'channel-101', name: "BBC World News", group: "News", number: 101, url: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4" },
                    { id: 'channel-102', name: "CNN International", group: "News", number: 102, url: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_2mb.mp4" },
                    { id: 'channel-201', name: "ESPN HD", group: "Sports", number: 201, url: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_5mb.mp4" },
                    { id: 'channel-202', name: "HBO HD", group: "Entertainment", number: 202, url: "https://sample-videos.com/video123/mp4/480/big_buck_bunny_480p_1mb.mp4" },
                    { id: 'channel-301', name: "National Geographic", group: "Documentary", number: 301, url: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4" },
                    { id: 'channel-302', name: "Discovery Channel", group: "Documentary", number: 302, url: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_2mb.mp4" },
                ];
                this.filteredChannels = [...this.channels];
                this.renderChannelList();
            },
            
            renderChannelList() {
                const container = document.getElementById('channelList');
                container.innerHTML = '';
                
                document.getElementById('channelCount').textContent = this.filteredChannels.length;
                
                // Group by category
                const categories = {};
                this.filteredChannels.forEach(channel => {
                    if (!categories[channel.group]) {
                        categories[channel.group] = [];
                    }
                    categories[channel.group].push(channel);
                });
                
                // Render categories
                for (const [category, channels] of Object.entries(categories)) {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'channel-category';
                    categoryDiv.innerHTML = `
                        <div class="category-title">${category.toUpperCase()}</div>
                    `;
                    
                    channels.forEach((channel, index) => {
                        const channelIndex = this.filteredChannels.findIndex(c => c.id === channel.id);
                        const channelDiv = document.createElement('div');
                        channelDiv.className = `channel-card ${this.currentChannel?.id === channel.id ? 'active' : ''}`;
                        channelDiv.dataset.index = channelIndex;
                        
                        // Check if 3-digit channel
                        const isThreeDigit = channel.number >= 100;
                        const badgeClass = isThreeDigit ? 'channel-badge three-digit' : 'channel-badge';
                        
                        channelDiv.innerHTML = `
                            <div class="${badgeClass}">${channel.number}</div>
                            <div class="channel-info">
                                <div class="channel-name">${channel.name}</div>
                                <div class="channel-meta">
                                    <span>${channel.group}</span>
                                    <div class="live-indicator"></div>
                                </div>
                            </div>
                        `;
                        
                        channelDiv.addEventListener('click', () => {
                            this.selectChannel(channelIndex);
                        });
                        
                        categoryDiv.appendChild(channelDiv);
                    });
                    
                    container.appendChild(categoryDiv);
                }
            },
            
            selectChannel(index) {
                if (index < 0 || index >= this.filteredChannels.length) return;
                
                const channel = this.filteredChannels[index];
                this.currentChannel = channel;
                this.hasUserSelectedChannel = true;
                
                // Update UI
                this.showChannelDisplay(channel);
                
                // Update channel list selection
                document.querySelectorAll('.channel-card').forEach(card => {
                    card.classList.remove('active');
                });
                document.querySelector(`.channel-card[data-index="${index}"]`)?.classList.add('active');
                
                // Hide placeholder
                this.showPlayerPlaceholder(false);
                
                // Enable playback controls
                this.enablePlaybackControls(true);
                
                // Load channel but DON'T auto-play
                this.loadChannel(channel);
                
                // Update viewer counter (simulated)
                this.updateViewerCount(Math.floor(Math.random() * 1000) + 100);
                
                // Notify WebSocket
                if (this.wsConnected) {
                    this.sendWebSocketMessage({
                        type: 'channel_change',
                        channel: channel.id,
                        name: channel.name
                    });
                }
                
                // Update channel input field
                document.getElementById('channelInput').value = channel.number;
            },
            
            showChannelDisplay(channel) {
                const display = document.getElementById('channelDisplay');
                const numberElement = document.getElementById('displayChannelNumber');
                const nameElement = document.getElementById('displayChannelName');
                const groupElement = document.getElementById('displayChannelGroup');
                
                // Update display content
                numberElement.textContent = channel.number.toString().padStart(3, '0');
                nameElement.textContent = channel.name;
                groupElement.textContent = channel.group;
                
                // Show display
                display.classList.remove('hidden');
                
                // Show player overlay and controls briefly
                this.showPlayerOverlay();
                
                // Start 5-second timer to hide display and controls
                this.startHideTimer();
            },
            
            showPlayerOverlay() {
                const playerOverlay = document.getElementById('playerOverlay');
                const controlsBar = document.getElementById('controlsBar');
                
                playerOverlay.classList.remove('hidden');
                playerOverlay.classList.add('active');
                controlsBar.classList.remove('hidden');
            },
            
            startHideTimer() {
                // Clear any existing hide timer
                if (this.hideOverlayTimeout) {
                    clearTimeout(this.hideOverlayTimeout);
                }
                
                // Hide channel display after 5 seconds
                this.hideOverlayTimeout = setTimeout(() => {
                    this.hideOverlays();
                }, 5000);
            },
            
            hideOverlays() {
                const display = document.getElementById('channelDisplay');
                const playerOverlay = document.getElementById('playerOverlay');
                const controlsBar = document.getElementById('controlsBar');
                
                // Hide channel display
                display.classList.add('hidden');
                
                // Hide controls bar
                controlsBar.classList.add('hidden');
                
                // Keep player overlay visible but controls hidden
                playerOverlay.classList.remove('hidden');
                playerOverlay.classList.add('active');
                
                console.log('ðŸ“º Channel display and controls hidden after 5 seconds');
            },
            
            loadChannel(channel) {
                const video = document.getElementById('video-player');
                
                // Show buffering
                this.showBuffering(true, `Loading Channel ${channel.number}...`);
                
                // Reset video
                video.src = '';
                video.load();
                
                // Set new source with timeout
                setTimeout(() => {
                    video.src = channel.url;
                    video.crossOrigin = 'anonymous';
                    video.load();
                    
                    // Wait for video to be ready but DON'T auto-play
                    video.addEventListener('loadeddata', () => {
                        this.showBuffering(false);
                        // Video is loaded but paused - user must click play
                        this.isPlaying = false;
                        this.updatePlayButton();
                    }, { once: true });
                    
                    video.addEventListener('error', () => {
                        this.showBuffering(false);
                        this.showNotification('Failed to load channel. Please try another.');
                    });
                }, 300);
            },
            
            showPlayerPlaceholder(show) {
                const placeholder = document.getElementById('playerPlaceholder');
                const video = document.getElementById('video-player');
                
                if (show) {
                    placeholder.style.display = 'flex';
                    video.style.display = 'none';
                    this.enablePlaybackControls(false);
                } else {
                    placeholder.style.display = 'none';
                    video.style.display = 'block';
                }
            },
            
            enablePlaybackControls(enable) {
                const playPauseBtn = document.getElementById('playPause');
                const prevChannelBtn = document.getElementById('prevChannel');
                const nextChannelBtn = document.getElementById('nextChannel');
                const volumeSlider = document.getElementById('volumeSlider');
                
                if (enable) {
                    playPauseBtn.disabled = false;
                    prevChannelBtn.disabled = false;
                    nextChannelBtn.disabled = false;
                    volumeSlider.disabled = false;
                } else {
                    playPauseBtn.disabled = true;
                    prevChannelBtn.disabled = true;
                    nextChannelBtn.disabled = true;
                    volumeSlider.disabled = true;
                }
            },
            
            showBuffering(show, message = 'Buffering...') {
                const overlay = document.getElementById('bufferingOverlay');
                const text = document.getElementById('bufferingText');
                const subtext = document.getElementById('bufferingSubtext');
                
                this.isBuffering = show;
                
                if (show) {
                    overlay.classList.add('active');
                    text.textContent = message;
                    subtext.textContent = 'Preparing stream...';
                } else {
                    overlay.classList.remove('active');
                }
            },
            
            updatePlayButton() {
                const icon = document.getElementById('playIcon');
                icon.className = this.isPlaying ? 'fas fa-pause' : 'fas fa-play';
            },
            
            togglePlayPause() {
                // Show controls when user interacts
                this.showPlayerOverlay();
                this.startHideTimer();
                
                // Don't allow play if no channel is selected
                if (!this.currentChannel || !this.hasUserSelectedChannel) {
                    this.showNotification('Please select a channel first');
                    return;
                }
                
                const video = document.getElementById('video-player');
                
                if (this.isPlaying) {
                    video.pause();
                } else {
                    video.play().catch(error => {
                        console.error('Play error:', error);
                        this.showNotification('Unable to play. Click to try again.');
                    });
                }
                
                this.isPlaying = !this.isPlaying;
                this.updatePlayButton();
            },
            
            navigateChannels(direction) {
                // Show controls when user interacts
                this.showPlayerOverlay();
                this.startHideTimer();
                
                // Don't allow navigation if no channel is selected
                if (!this.currentChannel || !this.hasUserSelectedChannel) {
                    this.showNotification('Please select a channel first');
                    return;
                }
                
                const currentIndex = this.filteredChannels.findIndex(c => c.id === this.currentChannel.id);
                let newIndex = currentIndex + direction;
                
                if (newIndex < 0) {
                    newIndex = this.filteredChannels.length - 1;
                } else if (newIndex >= this.filteredChannels.length) {
                    newIndex = 0;
                }
                
                this.selectChannel(newIndex);
            },
            
            selectChannelByNumber(channelNumber) {
                // Convert to number
                const num = parseInt(channelNumber);
                if (isNaN(num)) {
                    this.showNotification('Please enter a valid channel number');
                    return false;
                }
                
                // Find channel by number
                const channelIndex = this.filteredChannels.findIndex(c => c.number === num);
                
                if (channelIndex === -1) {
                    this.showNotification(`Channel ${channelNumber} not found`);
                    return false;
                }
                
                // Select the channel
                this.selectChannel(channelIndex);
                return true;
            },
            
            toggleFullscreen() {
                const elem = document.documentElement;
                
                if (!this.isFullscreen) {
                    if (elem.requestFullscreen) {
                        elem.requestFullscreen();
                    } else if (elem.webkitRequestFullscreen) {
                        elem.webkitRequestFullscreen();
                    } else if (elem.mozRequestFullScreen) {
                        elem.mozRequestFullScreen();
                    } else if (elem.msRequestFullscreen) {
                        elem.msRequestFullscreen();
                    }
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.mozCancelFullScreen) {
                        document.mozCancelFullScreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                }
            },
            
            toggleSidebar() {
                this.isSidebarOpen = !this.isSidebarOpen;
                const sidebar = document.getElementById('channelSidebar');
                
                if (window.innerWidth <= 768) {
                    sidebar.classList.toggle('collapsed');
                } else {
                    sidebar.style.width = this.isSidebarOpen ? '280px' : '0';
                    sidebar.style.minWidth = this.isSidebarOpen ? '280px' : '0';
                }
            },
            
            updateViewerCount(count) {
                this.viewerCount = count;
                const countElement = document.getElementById('viewerCount');
                
                // Animate count change
                const current = parseInt(countElement.textContent) || 0;
                const diff = count - current;
                const steps = 10;
                const step = diff / steps;
                
                let currentStep = 0;
                const animate = () => {
                    if (currentStep < steps) {
                        currentStep++;
                        const value = Math.round(current + (step * currentStep));
                        countElement.textContent = this.formatNumber(value);
                        setTimeout(animate, 30);
                    } else {
                        countElement.textContent = this.formatNumber(count);
                    }
                };
                animate();
            },
            
            formatNumber(num) {
                if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                return num.toString();
            },
            
            initWebSocket() {
                // Using your WebSocket URL
                const wsUrl = 'wss://thomassin-production.up.railway.app';
                
                try {
                    const ws = new WebSocket(wsUrl);
                    
                    ws.onopen = () => {
                        console.log('âœ… Connected to viewer server');
                        this.wsConnected = true;
                        document.getElementById('connectionDot').className = 'connection-dot dot-connected';
                        
                        // Subscribe to current channel if selected
                        if (this.currentChannel) {
                            this.sendWebSocketMessage({
                                type: 'subscribe',
                                channel: this.currentChannel.id
                            });
                        }
                    };
                    
                    ws.onmessage = (event) => {
                        try {
                            const data = JSON.parse(event.data);
                            this.handleWebSocketMessage(data);
                        } catch (error) {
                            console.error('WebSocket message error:', error);
                        }
                    };
                    
                    ws.onerror = (error) => {
                        console.error('WebSocket error:', error);
                        this.wsConnected = false;
                        document.getElementById('connectionDot').className = 'connection-dot dot-disconnected';
                    };
                    
                    ws.onclose = () => {
                        console.log('ðŸ“¡ WebSocket disconnected');
                        this.wsConnected = false;
                        document.getElementById('connectionDot').className = 'connection-dot dot-connecting';
                        
                        // Try to reconnect
                        setTimeout(() => this.initWebSocket(), 3000);
                    };
                    
                    this.ws = ws;
                } catch (error) {
                    console.error('WebSocket connection failed:', error);
                }
            },
            
            sendWebSocketMessage(data) {
                if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this.ws.send(JSON.stringify(data));
                }
            },
            
            handleWebSocketMessage(data) {
                switch(data.type) {
                    case 'viewer_count':
                        this.updateViewerCount(data.count);
                        break;
                    case 'live_event':
                        this.showNotification(data.message);
                        break;
                    case 'stats':
                        this.updateNetworkStats(data.stats);
                        break;
                }
            },
            
            showNotification(message) {
                // Create notification
                const notification = document.createElement('div');
                notification.className = 'glass-effect';
                notification.style.cssText = `
                    position: absolute;
                    top: 80px;
                    right: 20px;
                    padding: 12px 16px;
                    border-radius: var(--radius-md);
                    color: white;
                    font-size: 0.875rem;
                    animation: slideIn 0.3s ease;
                    z-index: 1000;
                    max-width: 300px;
                `;
                notification.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-bolt" style="color: var(--warning);"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                document.querySelector('.player-container').appendChild(notification);
                
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100px)';
                    setTimeout(() => notification.remove(), 300);
                }, 5000);
            },
            
            updateNetworkStats(stats) {
                const speedElement = document.getElementById('networkSpeed');
                if (stats.speed) {
                    speedElement.textContent = `${stats.speed.toFixed(1)} Mbps`;
                }
            },
            
            filterChannels(searchTerm) {
                if (!searchTerm) {
                    this.filteredChannels = [...this.channels];
                } else {
                    const term = searchTerm.toLowerCase();
                    this.filteredChannels = this.channels.filter(channel =>
                        channel.name.toLowerCase().includes(term) ||
                        channel.group.toLowerCase().includes(term) ||
                        channel.number.toString().includes(term)
                    );
                }
                
                this.renderChannelList();
            },
            
            setupEventListeners() {
                // Play/Pause - only works when channel is selected
                document.getElementById('playPause').addEventListener('click', () => this.togglePlayPause());
                
                // Navigation - only works when channel is selected
                document.getElementById('prevChannel').addEventListener('click', () => this.navigateChannels(-1));
                document.getElementById('nextChannel').addEventListener('click', () => this.navigateChannels(1));
                
                // Fullscreen
                document.getElementById('fullscreenBtn').addEventListener('click', () => this.toggleFullscreen());
                
                // Sidebar toggle
                document.getElementById('sidebarToggle').addEventListener('click', () => this.toggleSidebar());
                
                // Channel input
                const channelInput = document.getElementById('channelInput');
                const channelGoBtn = document.getElementById('channelGoBtn');
                
                // Only allow numbers in channel input
                channelInput.addEventListener('input', (e) => {
                    e.target.value = e.target.value.replace(/\D/g, '').slice(0, 3);
                });
                
                // Enter key to go to channel
                channelInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.selectChannelByNumber(channelInput.value);
                    }
                });
                
                // Go button
                channelGoBtn.addEventListener('click', () => {
                    this.selectChannelByNumber(channelInput.value);
                });
                
                // Volume control
                const volumeSlider = document.getElementById('volumeSlider');
                const volumeIcon = document.getElementById('volumeIcon');
                
                volumeSlider.addEventListener('input', (e) => {
                    this.volume = parseFloat(e.target.value);
                    document.getElementById('video-player').volume = this.volume;
                    
                    // Update icon
                    if (this.volume === 0) {
                        volumeIcon.className = 'fas fa-volume-off';
                    } else if (this.volume < 0.5) {
                        volumeIcon.className = 'fas fa-volume-down';
                    } else {
                        volumeIcon.className = 'fas fa-volume-up';
                    }
                });
                
                // Search
                document.getElementById('channelSearch').addEventListener('input', (e) => {
                    this.filterChannels(e.target.value);
                });
                
                // Fullscreen change
                document.addEventListener('fullscreenchange', this.handleFullscreenChange.bind(this));
                document.addEventListener('webkitfullscreenchange', this.handleFullscreenChange.bind(this));
                document.addEventListener('mozfullscreenchange', this.handleFullscreenChange.bind(this));
                document.addEventListener('MSFullscreenChange', this.handleFullscreenChange.bind(this));
                
                // Mouse movement shows controls
                document.addEventListener('mousemove', () => {
                    if (this.currentChannel && this.hasUserSelectedChannel) {
                        this.showPlayerOverlay();
                        this.startHideTimer();
                    }
                });
                
                document.addEventListener('touchstart', () => {
                    if (this.currentChannel && this.hasUserSelectedChannel) {
                        this.showPlayerOverlay();
                        this.startHideTimer();
                    }
                });
                
                // Keyboard shortcuts
                document.addEventListener('keydown', this.handleKeyboard.bind(this));
            },
            
            handleFullscreenChange() {
                this.isFullscreen = !!(document.fullscreenElement || 
                                      document.webkitFullscreenElement ||
                                      document.mozFullScreenElement ||
                                      document.msFullscreenElement);
                
                document.body.classList.toggle('fullscreen', this.isFullscreen);
                
                // Update fullscreen button icon
                const icon = document.querySelector('#fullscreenBtn i');
                icon.className = this.isFullscreen ? 'fas fa-compress' : 'fas fa-expand';
            },
            
            handleKeyboard(event) {
                switch(event.key) {
                    case ' ':
                    case 'k':
                        event.preventDefault();
                        this.togglePlayPause();
                        break;
                        
                    case 'f':
                    case 'F':
                        event.preventDefault();
                        this.toggleFullscreen();
                        break;
                        
                    case 'ArrowUp':
                        event.preventDefault();
                        this.navigateChannels(-1);
                        break;
                        
                    case 'ArrowDown':
                        event.preventDefault();
                        this.navigateChannels(1);
                        break;
                        
                    case 's':
                    case 'S':
                        event.preventDefault();
                        this.toggleSidebar();
                        break;
                        
                    case 'Escape':
                        if (this.isFullscreen) {
                            this.toggleFullscreen();
                        }
                        break;
                        
                    // Number keys for direct channel input
                    case '0':
                    case '1':
                    case '2':
                    case '3':
                    case '4':
                    case '5':
                    case '6':
                    case '7':
                    case '8':
                    case '9':
                        if (!event.ctrlKey && !event.altKey && !event.metaKey) {
                            const channelInput = document.getElementById('channelInput');
                            const currentValue = channelInput.value;
                            
                            // If input is focused, let normal input happen
                            if (document.activeElement !== channelInput) {
                                event.preventDefault();
                                
                                // Add digit to input (max 3 digits)
                                if (currentValue.length < 3) {
                                    channelInput.value = currentValue + event.key;
                                } else {
                                    // Replace last digit
                                    channelInput.value = currentValue.slice(1) + event.key;
                                }
                                
                                // Focus and select the input
                                channelInput.focus();
                                channelInput.select();
                            }
                        }
                        break;
                        
                    // Enter to submit channel input
                    case 'Enter':
                        if (document.activeElement !== document.getElementById('channelInput')) {
                            const channelInput = document.getElementById('channelInput');
                            if (channelInput.value) {
                                event.preventDefault();
                                this.selectChannelByNumber(channelInput.value);
                            }
                        }
                        break;
                }
            },
            
            setupVideoPlayer() {
                const video = document.getElementById('video-player');
                const progressBar = document.getElementById('progressBar');
                
                // Set initial volume
                video.volume = this.volume;
                
                // Progress tracking
                video.addEventListener('timeupdate', () => {
                    if (video.duration) {
                        const progress = (video.currentTime / video.duration) * 100;
                        progressBar.style.width = `${progress}%`;
                    }
                });
                
                // Play state tracking
                video.addEventListener('play', () => {
                    this.isPlaying = true;
                    this.updatePlayButton();
                });
                
                video.addEventListener('pause', () => {
                    this.isPlaying = false;
                    this.updatePlayButton();
                });
                
                video.addEventListener('waiting', () => {
                    if (!this.isBuffering) {
                        this.showBuffering(true, 'Buffering...');
                    }
                });
                
                video.addEventListener('playing', () => {
                    this.showBuffering(false);
                });
                
                video.addEventListener('error', (e) => {
                    console.error('Video error:', video.error);
                    this.showBuffering(false);
                    this.showNotification('Channel error. Please try another.');
                });
            }
        };

        // ==================== INITIALIZE APP ====================
        document.addEventListener('DOMContentLoaded', () => {
            UIState.init();
            
            // Update network speed display
            setInterval(() => {
                const speed = 5 + Math.random() * 50; // Simulated speed
                document.getElementById('networkSpeed').textContent = `${speed.toFixed(1)} Mbps`;
            }, 5000);
        });
    </script>
</body>
</html>















